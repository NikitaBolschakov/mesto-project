(()=>{"use strict";var e=document.querySelector(".profile__name"),t=document.querySelector(".profile__status"),n=document.querySelector("#popup-form-edit"),o=document.querySelector("#field-name"),r=document.querySelector("#field-job"),c=document.querySelector("#popup-form-update"),u=document.querySelector("#card").content,a=document.querySelector(".popup__image"),i=document.querySelector(".popup__caption"),l=document.querySelector("#field-name-image"),s=document.querySelector("#field-link-image"),d=document.querySelector(".gallery"),p=document.querySelector("#popup-form-add"),f=document.querySelector(".profile__button-edit"),m=document.querySelector("#close-popup-edit"),v=document.querySelector("#popup-edit"),y=document.querySelector(".profile__button-add"),_=document.querySelector("#close-popup-add"),h=document.querySelector("#popup-add"),b=document.querySelector("#close-popup-image"),S=document.querySelector("#popup-update"),q=document.querySelector("#close-popup-update"),E=document.querySelector(".profile__ovl"),g=document.querySelector("#popup-image"),k=document.querySelector("#button-submit-edit"),L=document.querySelector("#button-submit-add"),C=document.querySelector("#button-avatar-save"),A=document.querySelector("#field-avatar"),x=document.querySelector(".profile__avatar"),U={formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__button-submit",inactiveButtonClass:"popup__button-submit_inactive",inputErrorClass:"popup__field_type_error",errorClass:"popup__field-error_active"},w=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",B),document.addEventListener("click",j)},T=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",B),document.removeEventListener("click",j)},B=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");T(t)}},j=function(e){var t=document.querySelector(".popup_opened");e.target===t&&T(t)},D={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-9",headers:{authorization:"1b487e52-d8c5-49f3-ac21-d7a7885c0589","Content-Type":"application/json"}},O=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},P=function(n){e.textContent=n.name,t.textContent=n.about,x.style.backgroundImage="url(".concat(n.avatar,")"),o.value=n.name,r.value=n.about},I=function(e,t){var n=u.querySelector(".element").cloneNode(!0),o=n.querySelector(".element__title"),r=n.querySelector(".element__image"),c=n.querySelector(".element__button-delete"),l=n.querySelector(".element__counter"),s=n.querySelector(".element__button-like");return o.textContent=e.name,r.src=e.link,r.alt=e.name,l.textContent=e.likes.length,r.addEventListener("click",(function(){a.setAttribute("src",e.link),a.setAttribute("alt",e.name),i.textContent=e.name,w(g)})),s.addEventListener("click",(function(t){var n;t.target.classList.contains("element__button-like_active")?function(e){return fetch("".concat(D.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:D.headers}).then(O)}(e._id).then((function(e){s.classList.remove("element__button-like_active"),l.textContent=e.likes.length})).catch((function(e){console.log(e)})):(n=e._id,fetch("".concat(D.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:D.headers}).then(O)).then((function(e){s.classList.add("element__button-like_active"),l.textContent=e.likes.length})).catch((function(e){console.log(e)}))})),e.likes.some((function(e){return e._id===t}))&&s.classList.add("element__button-like_active"),c.addEventListener("click",(function(){var t;(t=e._id,fetch("".concat(D.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:D.headers}).then(O)).then((function(){n.remove(),function(e){throw new TypeError('"cardElement" is read-only')}()})).catch((function(e){console.log(e)}))})),e.owner._id===t&&(c.style.display="block"),n},N=function(e){e.classList.add(U.inactiveButtonClass),e.setAttribute("disabled",!0)},J=function(e,t){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,U):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,U)},H=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled",!0)):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0))},M=function(e,t){e?(t.textContent="Сохранение...",t.disabled=!0):(t.hasAttribute("button-submit-edit")?L.textContent="Создать":t.textContent="Сохранить",t.disabled=!1)};function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}p.addEventListener("submit",(function(e){var t,n;e.preventDefault(),M(!0,L),t=l.value,n=s.value,function(e,t){return fetch("".concat(D.baseUrl,"/cards"),{method:"POST",headers:D.headers,body:JSON.stringify({name:e,link:t})}).then(O)}(t,n).then((function(e){d.prepend(I(e,e.owner._id))})).catch((function(e){console.log(e)})).finally((function(){M(!1,L)})),e.target.reset(),N(L),T(h)})),c.addEventListener("submit",(function(e){var t,n;e.preventDefault(),M(!0,C),n=A.value,x.style.backgroundImage="url(".concat(n,")"),(t=n,fetch("".concat(D.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:D.headers,body:JSON.stringify({avatar:t})}).then(O)).then((function(e){P(e)})).catch((function(e){console.log(e)})).finally((function(){M(!1,C)})),e.target.reset(),N(C),T(S)})),f.addEventListener("click",(function(){w(v)})),m.addEventListener("click",(function(){T(v)})),y.addEventListener("click",(function(){w(h)})),_.addEventListener("click",(function(){T(h)})),b.addEventListener("click",(function(){T(g)})),E.addEventListener("click",(function(){w(S)})),q.addEventListener("click",(function(){T(S)})),n.addEventListener("submit",(function(n){n.preventDefault(),M(!0,k);var c,u,a=o.value,i=r.value;e.textContent=a,t.textContent=i,(c=a,u=i,fetch("".concat(D.baseUrl,"/users/me"),{method:"PATCH",headers:D.headers,body:JSON.stringify({name:c,about:u})}).then(O)).then((function(e){P(e)})).catch((function(e){console.log(e)})).finally((function(){M(!1,k)})),T(v)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);H(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){J(e,r),H(n,o,t)}))}))}(t,e)}))}({formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__button-submit",inactiveButtonClass:"popup__button-submit_inactive",inputErrorClass:"popup__field_type_error",errorClass:"popup__field-error_active"}),Promise.all([fetch("".concat(D.baseUrl,"/users/me"),{headers:D.headers}).then(O),fetch("".concat(D.baseUrl,"/cards"),{headers:D.headers}).then(O)]).then((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c=[],u=!0,a=!1;try{for(n=n.call(e);!(u=(o=n.next()).done)&&(c.push(o.value),!t||c.length!==t);u=!0);}catch(e){a=!0,r=e}finally{try{u||null==n.return||n.return()}finally{if(a)throw r}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],c=o[1];P(r),c.forEach((function(e){d.append(I(e,r._id))}))})).catch((function(e){console.log(e)}))})();