(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{BD:()=>X,fB:()=>F,UX:()=>$});var t=document.querySelector(".profile__name"),n=document.querySelector(".profile__status"),o=document.querySelector("#popup-form-edit"),r=document.querySelector("#field-name"),c=document.querySelector("#field-job"),u=document.querySelector("#popup-form-update"),a=document.querySelector("#card").content,i=document.querySelector(".popup__image"),l=document.querySelector(".popup__caption"),s=document.querySelector("#field-name-image"),d=document.querySelector("#field-link-image"),p=document.querySelector(".gallery"),f=document.querySelector("#popup-form-add"),m=document.querySelector(".profile__button-edit"),v=document.querySelector("#close-popup-edit"),y=document.querySelector("#popup-edit"),_=document.querySelector(".profile__button-add"),b=document.querySelector("#close-popup-add"),h=document.querySelector("#popup-add"),S=document.querySelector("#close-popup-image"),q=document.querySelector("#popup-update"),k=document.querySelector("#close-popup-update"),g=document.querySelector(".profile__ovl"),E=document.querySelector("#popup-image"),L=document.querySelector("#button-submit-edit"),C=document.querySelector("#button-submit-add"),A=document.querySelector("#button-avatar-save"),x=document.querySelector("#field-avatar"),U=document.querySelector(".profile__avatar"),B={formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__button-submit",inactiveButtonClass:"popup__button-submit_inactive",inputErrorClass:"popup__field_type_error",errorClass:"popup__field-error_active"},j=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",O),document.addEventListener("click",P)},w=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",O),document.removeEventListener("click",P)},O=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");w(t)}},P=function(e){var t=document.querySelector(".popup_opened");e.target===t&&w(t)},T=function(e,t){var n=a.querySelector(".element").cloneNode(!0),o=n.querySelector(".element__title"),r=n.querySelector(".element__image"),c=n.querySelector(".element__button-delete"),u=n.querySelector(".element__counter"),s=n.querySelector(".element__button-like");return o.textContent=e.name,r.src=e.link,r.alt=e.name,u.textContent=e.likes.length,r.addEventListener("click",(function(){i.setAttribute("src",e.link),i.setAttribute("alt",e.name),l.textContent=e.name,j(E)})),s.addEventListener("click",(function(t){t.target.classList.contains("element__button-like_active")?F(e._id,n):$(e._id,n)})),e.likes.some((function(e){return e._id===t}))&&s.classList.add("element__button-like_active"),c.addEventListener("click",(function(){X(e._id,n)})),e.owner._id===t&&(c.style.display="block"),n},D=function(e){e.classList.add(B.inactiveButtonClass),e.setAttribute("disabled",!0)},I=function(e,t){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,B):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,B)},N=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled",!0)):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0))},J={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-9",headers:{authorization:"1b487e52-d8c5-49f3-ac21-d7a7885c0589","Content-Type":"application/json"}},H=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},M=function(e,t){e?(t.textContent="Сохранение...",t.disabled=!0):(t.hasAttribute("button-submit-edit")?C.textContent="Создать":t.textContent="Сохранить",t.disabled=!1)};function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var X=function(e,t){var n;(n=e,fetch("".concat(J.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:J.headers}).then(H)).then((function(){t.remove(),t=null})).catch((function(e){console.log(e)}))},$=function(e,t){var n;(n=e,fetch("".concat(J.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:J.headers}).then(H)).then((function(e){var n=t.querySelector(".element__counter");t.querySelector(".element__button-like").classList.add("element__button-like_active"),n.textContent=e.likes.length})).catch((function(e){console.log(e)}))},F=function(e,t){var n;(n=e,fetch("".concat(J.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:J.headers}).then(H)).then((function(e){var n=t.querySelector(".element__counter");t.querySelector(".element__button-like").classList.remove("element__button-like_active"),n.textContent=e.likes.length})).catch((function(e){console.log(e)}))},G=function(e){e.reset()},K=function(e){t.textContent=e.name,n.textContent=e.about,r.value=e.name,c.value=e.about,U.style.backgroundImage="url(".concat(e.avatar,")")};f.addEventListener("submit",(function(e){var t,n;e.preventDefault(),M(!0,C),t=s.value,n=d.value,function(e,t){return fetch("".concat(J.baseUrl,"/cards"),{method:"POST",headers:J.headers,body:JSON.stringify({name:e,link:t})}).then(H)}(t,n).then((function(e){p.prepend(T(e,e.owner._id)),w(h),G(f),D(C)})).catch((function(e){console.log(e)})).finally((function(){M(!1,C)}))})),u.addEventListener("submit",(function(e){var t,n;e.preventDefault(),M(!0,A),n=x.value,(t=n,fetch("".concat(J.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:J.headers,body:JSON.stringify({avatar:t})}).then(H)).then((function(e){K(e),U.style.backgroundImage="url(".concat(n,")"),w(q),G(u),D(A)})).catch((function(e){console.log(e)})).finally((function(){M(!1,A)}))})),m.addEventListener("click",(function(){j(y)})),v.addEventListener("click",(function(){w(y)})),_.addEventListener("click",(function(){j(h)})),b.addEventListener("click",(function(){w(h)})),S.addEventListener("click",(function(){w(E)})),g.addEventListener("click",(function(){j(q)})),k.addEventListener("click",(function(){w(q)})),o.addEventListener("submit",(function(e){e.preventDefault(),M(!0,L);var o,u,a=r.value,i=c.value;(o=a,u=i,fetch("".concat(J.baseUrl,"/users/me"),{method:"PATCH",headers:J.headers,body:JSON.stringify({name:o,about:u})}).then(H)).then((function(e){K(e),t.textContent=a,n.textContent=i,w(y)})).catch((function(e){console.log(e)})).finally((function(){M(!1,L)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);N(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){I(e,r),N(n,o,t)}))}))}(t,e)}))}({formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__button-submit",inactiveButtonClass:"popup__button-submit_inactive",inputErrorClass:"popup__field_type_error",errorClass:"popup__field-error_active"}),Promise.all([fetch("".concat(J.baseUrl,"/users/me"),{headers:J.headers}).then(H),fetch("".concat(J.baseUrl,"/cards"),{headers:J.headers}).then(H)]).then((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c=[],u=!0,a=!1;try{for(n=n.call(e);!(u=(o=n.next()).done)&&(c.push(o.value),!t||c.length!==t);u=!0);}catch(e){a=!0,r=e}finally{try{u||null==n.return||n.return()}finally{if(a)throw r}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],c=o[1];K(r),c.forEach((function(e){p.append(T(e,r._id))}))})).catch((function(e){console.log(e)}))})();